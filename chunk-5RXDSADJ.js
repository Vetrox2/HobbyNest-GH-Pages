import{a as S,g}from"./chunk-TUSFAYHM.js";import{j as v}from"./chunk-NL76DNNZ.js";import{B as f,Db as m,Y as r,aa as h,ga as c,j as s,l as C,p as b}from"./chunk-BNW6Q7MZ.js";import{a as u,b as d}from"./chunk-EQDQRRRY.js";var _=class a{apiService=c(S);notificationService=c(g);translation=c(v);_collectionEndpoint="collection";_collectionItemEndpoint="collectionitem";_selfCollections=m([]);get selfCollections(){return this._selfCollections.asReadonly()}resetState(){this._selfCollections.set([])}fetchSelfCollections(){this.getMyCollections().pipe(r(e=>{this._selfCollections.set(e??[])}),f(()=>(this._selfCollections().length==0&&this._selfCollections.set([]),s))).subscribe()}getMyCollections(){return this.apiService.get(this._collectionEndpoint)}getUserCollections(e){return this.apiService.get(this._collectionEndpoint+"/user",e)}getCollection(e){return this.apiService.get(this._collectionEndpoint,e)}getCollectionItems(e){return this.apiService.get(this._collectionItemEndpoint,e)}addCollection(e){return this.apiService.post(this._collectionEndpoint,e).pipe(b(t=>(this._selfCollections.update(i=>[...i,t]),t)),f(t=>{let i=t instanceof Error?t.message:typeof t=="string"?t:void 0;return this.notificationService.showFailure(i),C(null)}))}updateCollectionPublicStatus(e,t){let i={id:e,isPublic:t};return this.apiService.patch(this._collectionEndpoint+"/public",i).pipe(r(()=>{let l=this._selfCollections().findIndex(o=>o.id===e);l!=-1&&this._selfCollections.update(o=>{let n=[...o];return n[l]=d(u({},n[l]),{isPublic:t}),n})}))}updateCollectionName(e,t,i){if(t=t.trim(),t===i)return s;if(!this.validateCollectionName(t))return this.notificationService.showFailure(`${this.translation.translate("error.lengthError",{value:100})} ${this.translation.translate("error.notEmpty")}`),s;let l={id:e,name:t};return this.apiService.patch(this._collectionEndpoint+"/name",l).pipe(r(()=>{let o=this._selfCollections().findIndex(n=>n.id===e);o!=-1&&this._selfCollections.update(n=>{let p=[...n];return p[o]=d(u({},p[o]),{name:t}),p})}))}deleteCollection(e){return this.apiService.delete(this._collectionEndpoint,e).pipe(r(()=>{this._selfCollections().findIndex(i=>i.id===e)!=-1&&(this._selfCollections.update(i=>i.filter(l=>l.id!==e)),this.notificationService.showSuccess())}))}increaseCollectionItemsCount(e,t=1){this._selfCollections.update(i=>{let l=[...i],o=l.find(n=>n.id===e);return o&&(o.itemCount+=t),l})}validateCollectionName(e){return e!=""&&e.length<=100}static \u0275fac=function(t){return new(t||a)};static \u0275prov=h({token:a,factory:a.\u0275fac,providedIn:"root"})};export{_ as a};
