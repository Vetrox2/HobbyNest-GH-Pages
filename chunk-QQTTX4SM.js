import{a as v,s as S}from"./chunk-GB5FS4AS.js";import{Db as h,E as d,_ as c,a as p,b as u,ca as m,ia as f,m as s,o as C,s as b}from"./chunk-GTZL7DLP.js";var _=class r{apiService=f(v);notificationService=f(S);_collectionEndpoint="collection";_collectionItemEndpoint="collectionitem";_selfCollections=h([]);get selfCollections(){return this._selfCollections.asReadonly()}resetState(){this._selfCollections.set([])}fetchSelfCollections(){this.getMyCollections().pipe(c(e=>{this._selfCollections.set(e??[])}),d(()=>(this._selfCollections().length==0&&this._selfCollections.set([]),s))).subscribe()}getMyCollections(){return this.apiService.get(this._collectionEndpoint)}getUserCollections(e){return this.apiService.get(this._collectionEndpoint+"/user",e)}getCollection(e){return this.apiService.get(this._collectionEndpoint,e)}getCollectionItems(e){return this.apiService.get(this._collectionItemEndpoint,e)}addCollection(e){return this.apiService.post(this._collectionEndpoint,e).pipe(b(t=>(this._selfCollections.update(i=>[...i,t]),t)),d(t=>{let i=t instanceof Error?t.message:typeof t=="string"?t:void 0;return this.notificationService.showFailure(i),C(null)}))}updateCollectionPublicStatus(e,t){let i={id:e,isPublic:t};return this.apiService.patch(this._collectionEndpoint+"/public",i).pipe(c(()=>{let l=this._selfCollections().findIndex(o=>o.id===e);l!=-1&&this._selfCollections.update(o=>{let n=[...o];return n[l]=u(p({},n[l]),{isPublic:t}),n})}))}updateCollectionName(e,t,i){if(t=t.trim(),t===i)return s;if(!this.validateCollectionName(t))return this.notificationService.showFailure("Maximum 100 characters. Not empty."),s;let l={id:e,name:t};return this.apiService.patch(this._collectionEndpoint+"/name",l).pipe(c(()=>{let o=this._selfCollections().findIndex(n=>n.id===e);o!=-1&&this._selfCollections.update(n=>{let a=[...n];return a[o]=u(p({},a[o]),{name:t}),a})}))}deleteCollection(e){return this.apiService.delete(this._collectionEndpoint,e).pipe(c(()=>{this._selfCollections().findIndex(i=>i.id===e)!=-1&&(this._selfCollections.update(i=>i.filter(l=>l.id!==e)),this.notificationService.showSuccess())}))}increaseCollectionItemsCount(e,t=1){this._selfCollections.update(i=>{let l=[...i],o=l.find(n=>n.id===e);return o&&(o.itemCount+=t),l})}validateCollectionName(e){return e!=""&&e.length<=100}static \u0275fac=function(t){return new(t||r)};static \u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})};export{_ as a};
