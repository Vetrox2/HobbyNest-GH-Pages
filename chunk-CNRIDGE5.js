import{a as E}from"./chunk-7KZ43VA4.js";import{a as T,r as y,s as U}from"./chunk-6S5I5LFA.js";import{l as S}from"./chunk-52EUMQZR.js";import{Ab as d,E as l,Kc as I,_ as a,a as s,b as u,ca as p,ia as c,m as n,o as f,p as h,s as C}from"./chunk-TIIQBU2L.js";var v=class r{_router=c(S);isNavigatingToLogin=d(!1);_lastVisitedUrl=null;setLastVisitedUrl(t){this._lastVisitedUrl=t}navigateToLastVisited(){this._router.navigateByUrl(this._lastVisitedUrl??"/")}navigateWithoutHistory(t){this._router.navigate([t],{replaceUrl:!0})}navigateTo(t){this._router.navigate([t])}navigateWithParams(t,e){this._router.navigate([t,e])}navigateToHome(){this._router.navigate(this.pathToHome)}navigateToProfile(){this._router.navigate(this.pathToProfile)}navigateToSettings(){this._router.navigate(this.pathToSettings)}navigateToAbout(){this._router.navigate(this.pathToAbout)}navigateToLegal(){this._router.navigate(this.pathToLegal)}navigateToLogin(){this.isNavigatingToLogin.set(!0),this._router.navigate(this.pathToLogin)}navigateIfAuthenticated(t,e){this._router.navigate(e?[t]:this.pathToLogin)}get pathToHome(){return["/home"]}get pathToProfile(){return["/profile"]}get pathToCollections(){return["/collections"]}get pathToSettings(){return["/settings"]}get pathToAbout(){return["/about"]}get pathToLegal(){return["/legal"]}get pathToLogin(){return["/login"]}static \u0275fac=function(e){return new(e||r)};static \u0275prov=p({token:r,factory:r.\u0275fac,providedIn:"root"})};var g=class r{apiService=c(T);collectionItemEndpoint="collectionitem";searchItemEndpoint="mediasearch";addMediaItem(t){return this.apiService.post(this.collectionItemEndpoint+"/media",t)}addCustomItem(t){return this.apiService.post(this.collectionItemEndpoint+"/custom",t)}updateCustomItem(t){return this.apiService.patch(this.collectionItemEndpoint+"/custom",t)}updateCustomItemTitle(t,e){if(e=e.trim(),!t.customItem)return h(()=>new Error("An error occurred while updating custom item - item data is empty"));if(e===t.customItem.title)return n;if(!e||e.length>100)return h(()=>new Error("Maximum 100 characters. Not empty."));let i={id:t.id,title:e,description:t.customItem.description||""};return this.apiService.patch(this.collectionItemEndpoint+"/custom",i)}updateCustomItemDescription(t,e){if(e=e.trim(),!t.customItem)return h(()=>new Error("An error occurred while updating custom item - item data is empty"));if(e===t.customItem.description)return n;if(e&&e.length>2e3)return h(()=>new Error("Maximum 2000 characters."));let i={id:t.id,title:t.customItem.title,description:e};return this.apiService.patch(this.collectionItemEndpoint+"/custom",i)}updateItemRating(t){return this.apiService.patch(this.collectionItemEndpoint+"/rating",t)}updateItemToDoStatus(t){return this.apiService.patch(this.collectionItemEndpoint+"/todo",t)}deleteItem(t){return this.apiService.delete(this.collectionItemEndpoint,t)}searchMediaItems(t,e){return this.apiService.get(this.searchItemEndpoint,"",{CollectionId:t,SearchInput:e})}static \u0275fac=function(e){return new(e||r)};static \u0275prov=p({token:r,factory:r.\u0275fac,providedIn:"root"})};var A=class r{userService=c(E);collectionService=c(U);collectionItemService=c(g);notificationService=c(y);navigationService=c(v);currentCollection=d(null);currentCollectionItems=d(null);currentCollectionOwner=d(null);currentRatedItems=I(()=>this.currentCollectionItems()?.filter(t=>!t.toDo));currentToDoItems=I(()=>this.currentCollectionItems()?.filter(t=>t.toDo));isCollectionOwner=I(()=>this.currentCollection()?.userId===this.userService.selfUser()?.id);setCurrentCollectionData(t,e,i){this.currentCollection.set(t),this.currentCollectionItems.set(e),this.currentCollectionOwner.set(i)}resetState(){this.currentCollection.set(null),this.currentCollectionItems.set(null),this.currentCollectionOwner.set(null)}renameCollection(t){let e=this.currentCollection();e&&this.collectionService.updateCollectionName(e.id,t,e.name).pipe(a(()=>{this.currentCollection.update(i=>i?u(s({},i),{name:t}):null)}),l(()=>(this.notificationService.showFailure(),n))).subscribe()}changeCollectionPublicStatus(t){let e=this.currentCollection();e&&this.collectionService.updateCollectionPublicStatus(e.id,t).pipe(a(()=>{this.currentCollection.update(i=>i?u(s({},i),{isPublic:t}):null)}),l(()=>(this.notificationService.showFailure(),n))).subscribe()}deleteCollection(){let t=this.currentCollection();t&&this.collectionService.deleteCollection(t.id).pipe(a(()=>{this.resetState(),this.navigationService.navigateTo("/collections")}),l(()=>(this.notificationService.showFailure(),n))).subscribe()}addCustomItem(t){return this.addItem(t,e=>this.collectionItemService.addCustomItem(e))}addMediaItem(t){return this.addItem(t,e=>this.collectionItemService.addMediaItem(e))}toggleItemToDoStatus(t){let e=this.currentCollectionItems()?.findIndex(m=>m.id===t);if(e===void 0||e===-1)return;let i=!this.currentCollectionItems()?.at(e)?.toDo,o={id:t,toDo:i};this.collectionItemService.updateItemToDoStatus(o).pipe(a(()=>{this.currentCollectionItems.update(m=>{if(!m)return m;let b=[...m];return b[e]=u(s({},b[e]),{toDo:i}),this.notificationService.showSuccess("Status zmieniony pomy\u015Blnie"),b})}),l(()=>(this.notificationService.showFailure(),n))).subscribe()}deleteCollectionItem(t){this.collectionItemService.deleteItem(t).pipe(a(()=>{this.currentCollectionItems.update(e=>{if(!e)return e;let i=e.findIndex(m=>m.id===t);if(i===-1)return e;let o=[...e];return o.splice(i,1),this.notificationService.showSuccess(),o})}),l(()=>(this.notificationService.showFailure(),n))).subscribe()}updateItemRating(t){return this.collectionItemService.updateItemRating(t).pipe(a(()=>{this.currentCollectionItems.update(e=>e?e.map(i=>i.id===t.id?u(s({},i),{rating:t.rating}):i):null)}),C(()=>!0),l(()=>(this.notificationService.showFailure(),f(!1))))}updateCustomItemTitle(t,e){this.collectionItemService.updateCustomItemTitle(t,e).pipe(a(()=>{this.currentCollectionItems.update(i=>i?i.map(o=>o.id===t.id&&o.customItem?u(s({},o),{customItem:u(s({},o.customItem),{title:e})}):o):null)}),l(i=>(this.notificationService.showFailure(i.message),n))).subscribe()}updateCustomItemDescription(t,e){this.collectionItemService.updateCustomItemDescription(t,e).pipe(a(()=>{this.currentCollectionItems.update(i=>i?i.map(o=>o.id===t.id&&o.customItem?u(s({},o),{customItem:u(s({},o.customItem),{description:e})}):o):null)}),l(i=>(this.notificationService.showFailure(i.message),n))).subscribe()}addItem(t,e){return e(t).pipe(a(i=>{this.currentCollectionItems.update(o=>o?[...o,i]:[i])}),C(()=>!0),l(i=>{let o=i instanceof Error?i.message:typeof i=="string"?i:void 0;return this.notificationService.showFailure(o),f(!1)}))}static \u0275fac=function(e){return new(e||r)};static \u0275prov=p({token:r,factory:r.\u0275fac,providedIn:"root"})};export{g as a,v as b,A as c};
