import{a as T}from"./chunk-GKFBIJT3.js";import{a as w}from"./chunk-FKKXVRBC.js";import{r as b,s as S}from"./chunk-TQO57KJH.js";import{l as C}from"./chunk-HVWCVND4.js";import{Ab as d,E as r,Kc as h,_ as n,a as l,b as s,ca as p,ia as c,m as a,o as I,s as f}from"./chunk-7IX7LMTZ.js";var v=class u{_router=c(C);isNavigatingToLogin=d(!1);_lastVisitedUrl=null;setLastVisitedUrl(t){this._lastVisitedUrl=t}navigateToLastVisited(){this._router.navigateByUrl(this._lastVisitedUrl??"/")}navigateWithoutHistory(t){this._router.navigate([t],{replaceUrl:!0})}navigateTo(t){this._router.navigate([t])}navigateWithParams(t,e){this._router.navigate([t,e])}navigateToHome(){this._router.navigate(this.pathToHome)}navigateToProfile(){this._router.navigate(this.pathToProfile)}navigateToSettings(){this._router.navigate(this.pathToSettings)}navigateToAbout(){this._router.navigate(this.pathToAbout)}navigateToLegal(){this._router.navigate(this.pathToLegal)}navigateToLogin(){this.isNavigatingToLogin.set(!0),this._router.navigate(this.pathToLogin)}navigateIfAuthenticated(t,e){this._router.navigate(e?[t]:this.pathToLogin)}get pathToHome(){return["/home"]}get pathToProfile(){return["/profile"]}get pathToCollections(){return["/collections"]}get pathToSettings(){return["/settings"]}get pathToAbout(){return["/about"]}get pathToLegal(){return["/legal"]}get pathToLogin(){return["/login"]}static \u0275fac=function(e){return new(e||u)};static \u0275prov=p({token:u,factory:u.\u0275fac,providedIn:"root"})};var y=class u{userService=c(w);collectionService=c(S);collectionItemService=c(T);notificationService=c(b);navigationService=c(v);currentCollection=d(null);currentCollectionItems=d(null);currentCollectionOwner=d(null);currentRatedItems=h(()=>this.currentCollectionItems()?.filter(t=>!t.toDo));currentToDoItems=h(()=>this.currentCollectionItems()?.filter(t=>t.toDo));isCollectionOwner=h(()=>this.currentCollection()?.userId===this.userService.selfUser()?.id);setCurrentCollectionData(t,e,i){this.currentCollection.set(t),this.currentCollectionItems.set(e),this.currentCollectionOwner.set(i)}resetState(){this.currentCollection.set(null),this.currentCollectionItems.set(null),this.currentCollectionOwner.set(null)}renameCollection(t){let e=this.currentCollection();e&&this.collectionService.updateCollectionName(e.id,t,e.name).pipe(n(()=>{this.currentCollection.update(i=>i?s(l({},i),{name:t}):null)}),r(()=>(this.notificationService.showFailure(),a))).subscribe()}changeCollectionPublicStatus(t){let e=this.currentCollection();e&&this.collectionService.updateCollectionPublicStatus(e.id,t).pipe(n(()=>{this.currentCollection.update(i=>i?s(l({},i),{isPublic:t}):null)}),r(()=>(this.notificationService.showFailure(),a))).subscribe()}deleteCollection(){let t=this.currentCollection();t&&this.collectionService.deleteCollection(t.id).pipe(n(()=>{this.resetState(),this.navigationService.navigateTo("/collections")}),r(()=>(this.notificationService.showFailure(),a))).subscribe()}addCustomItem(t){return this.addItem(t,e=>this.collectionItemService.addCustomItem(e))}addMediaItem(t){return this.addItem(t,e=>this.collectionItemService.addMediaItem(e))}toggleItemToDoStatus(t){let e=this.currentCollectionItems()?.findIndex(m=>m.id===t);if(e===void 0||e===-1)return;let i=!this.currentCollectionItems()?.at(e)?.toDo,o={id:t,toDo:i};this.collectionItemService.updateItemToDoStatus(o).pipe(n(()=>{this.currentCollectionItems.update(m=>{if(!m)return m;let g=[...m];return g[e]=s(l({},g[e]),{toDo:i}),this.notificationService.showSuccess("Status zmieniony pomy\u015Blnie"),g})}),r(()=>(this.notificationService.showFailure(),a))).subscribe()}deleteCollectionItem(t){this.collectionItemService.deleteItem(t).pipe(n(()=>{this.currentCollectionItems.update(e=>{if(!e)return e;let i=e.findIndex(m=>m.id===t);if(i===-1)return e;let o=[...e];return o.splice(i,1),this.notificationService.showSuccess(),o})}),r(()=>(this.notificationService.showFailure(),a))).subscribe()}updateItemRating(t){return this.collectionItemService.updateItemRating(t).pipe(n(()=>{this.currentCollectionItems.update(e=>e?e.map(i=>i.id===t.id?s(l({},i),{rating:t.rating}):i):null)}),f(()=>!0),r(()=>(this.notificationService.showFailure(),I(!1))))}updateCustomItemTitle(t,e){this.collectionItemService.updateCustomItemTitle(t,e).pipe(n(()=>{this.currentCollectionItems.update(i=>i?i.map(o=>o.id===t.id&&o.customItem?s(l({},o),{customItem:s(l({},o.customItem),{title:e})}):o):null)}),r(i=>(this.notificationService.showFailure(i.message),a))).subscribe()}updateCustomItemDescription(t,e){this.collectionItemService.updateCustomItemDescription(t,e).pipe(n(()=>{this.currentCollectionItems.update(i=>i?i.map(o=>o.id===t.id&&o.customItem?s(l({},o),{customItem:s(l({},o.customItem),{description:e})}):o):null)}),r(i=>(this.notificationService.showFailure(i.message),a))).subscribe()}addItem(t,e){return e(t).pipe(n(i=>{this.currentCollectionItems.update(o=>o?[...o,i]:[i])}),f(()=>!0),r(i=>{let o=i instanceof Error?i.message:typeof i=="string"?i:void 0;return this.notificationService.showFailure(o),I(!1)}))}static \u0275fac=function(e){return new(e||u)};static \u0275prov=p({token:u,factory:u.\u0275fac,providedIn:"root"})};export{v as a,y as b};
