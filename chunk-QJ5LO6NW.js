import{a as f}from"./chunk-7O54PAA5.js";import{a as C}from"./chunk-H5G4WTIK.js";import{a as g,g as w}from"./chunk-X65OCW5U.js";import{o as u}from"./chunk-VEJEVNPP.js";import{H as n,Ib as o,a as m,b as F,bd as l,ca as d,ga as p,l as b,ma as t,p as c,r as h,v as S}from"./chunk-RQXFCEDV.js";var a={Accepted:"accepted",Sent:"sent",Received:"received",None:""};var v=class s{apiService=t(g);userService=t(f);notificationService=t(w);friendEndpoint="friend";sendRequestErrorMessage=u("friend.error.sendRequest");acceptRequestErrorMessage=u("friend.error.acceptRequest");deleteFriendErrorMessage=u("friend.error.deleteFriend");selfFriendsCount=l(()=>{let e=this._selfFriends();return e?e.filter(i=>i.status===a.Accepted).length:0});_selfFriends=o([]);get selfFriends(){return this._selfFriends.asReadonly()}resetState(){this._selfFriends.set([])}fetchSelfFriends(){this.getMyFriends().pipe(d(e=>{this._selfFriends.set(e??[])}),n(()=>(this._selfFriends.set([]),c))).subscribe()}searchFriends(e){return e.length?this.userService.searchUser(e).pipe(S(i=>i.slice(0,5).map(r=>{let E=this.getFriendStatus(r.id);return{id:r.id,profilePictureUrl:r.profilePictureUrl,username:r.username,status:E}})),n(()=>h([]))):h([])}getFriendStatus(e){return this._selfFriends()?.find(i=>i.id===e)?.status??""}getMyFriends(){return this.apiService.get(this.friendEndpoint)}getOtherUserFriends(e){return this.apiService.get(this.friendEndpoint,e)}getFriendsCount(e){return this.apiService.get(this.friendEndpoint+"/count",e)}sendFriendRequest(e){this.apiService.post(this.friendEndpoint,e).pipe(d(i=>{this._selfFriends.update(r=>r?[...r,i]:[i])}),n(()=>(this.notificationService.showFailure(this.sendRequestErrorMessage()),c))).subscribe()}acceptFriendRequest(e){this.apiService.patch(this.friendEndpoint+"/accept-request",e).pipe(d(()=>{this._selfFriends.update(i=>i?.map(r=>e===r.id?F(m({},r),{status:a.Accepted}):r))}),n(()=>(this.notificationService.showFailure(this.acceptRequestErrorMessage()),c))).subscribe()}deleteFriend(e){this.apiService.delete(this.friendEndpoint,e).pipe(d(()=>{this._selfFriends.update(i=>i?.filter(r=>r.id!==e))}),n(()=>(this.notificationService.showFailure(this.deleteFriendErrorMessage()),c))).subscribe()}static \u0275fac=function(i){return new(i||s)};static \u0275prov=p({token:s,factory:s.\u0275fac,providedIn:"root"})};var y=class s{userService=t(f);friendService=t(v);collectionService=t(C);viewedUser=o(null);viewedFriends=o(null);viewedCollections=o(null);currentProfileUser=l(()=>this.viewedUser()??this.userService.selfUser());currentProfileFriends=l(()=>this.viewedFriends()??this.friendService.selfFriends().filter(e=>e.status===a.Accepted));currentProfileCollections=l(()=>this.viewedCollections()??this.collectionService.selfCollections().sort((e,i)=>i.viewsCount-e.viewsCount));profileChangeSubject=new b;profileChange$=this.profileChangeSubject.asObservable();resetState(){this.viewedUser.set(null),this.viewedFriends.set(null),this.viewedCollections.set(null),this.profileChangeSubject.next(null)}setViewedUser(e,i,r){this.viewedUser.set(e),this.viewedFriends.set(i),this.viewedCollections.set(r),this.profileChangeSubject.next(null)}static \u0275fac=function(i){return new(i||s)};static \u0275prov=p({token:s,factory:s.\u0275fac,providedIn:"root"})};export{a,v as b,y as c};
