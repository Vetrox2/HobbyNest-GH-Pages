import{a as u}from"./chunk-J7LQMK27.js";import{a as S,r as g,s as w}from"./chunk-TBU2HHPG.js";import{Ab as o,E as s,Kc as l,_ as a,a as h,b as m,ca as p,ia as t,j as b,m as c,o as v,s as F}from"./chunk-7IX7LMTZ.js";var d={Accepted:"accepted",Sent:"sent",Received:"received",None:""};var f=class n{apiService=t(S);userService=t(u);notificationService=t(g);friendEndpoint="friend";selfFriendsCount=l(()=>{let e=this._selfFriends();return e?e.filter(i=>i.status===d.Accepted).length:0});_selfFriends=o([]);get selfFriends(){return this._selfFriends.asReadonly()}resetState(){this._selfFriends.set([])}fetchSelfFriends(){this.getMyFriends().pipe(a(e=>{this._selfFriends.set(e??[])}),s(()=>(this._selfFriends.set([]),c))).subscribe()}searchFriends(e){return e.length?this.userService.searchUser(e).pipe(F(i=>i.slice(0,5).map(r=>{let C=this.getFriendStatus(r.id);return{id:r.id,profilePictureUrl:r.profilePictureUrl,username:r.username,status:C}})),s(()=>v([]))):v([])}getFriendStatus(e){return this._selfFriends()?.find(i=>i.id===e)?.status??""}getMyFriends(){return this.apiService.get(this.friendEndpoint)}getOtherUserFriends(e){return this.apiService.get(this.friendEndpoint,e)}getFriendsCount(e){return this.apiService.get(this.friendEndpoint+"/count",e)}sendFriendRequest(e){this.apiService.post(this.friendEndpoint,e).pipe(a(i=>{this._selfFriends.update(r=>r?[...r,i]:[i])}),s(()=>(this.notificationService.showFailure("Wys\u0142anie zaproszenia zako\u0144czy\u0142o si\u0119 niepowodzeniem"),c))).subscribe()}acceptFriendRequest(e){this.apiService.patch(this.friendEndpoint+"/accept-request",e).pipe(a(()=>{this._selfFriends.update(i=>i?.map(r=>e===r.id?m(h({},r),{status:d.Accepted}):r))}),s(()=>(this.notificationService.showFailure("Zaakceptowanie zaproszenia zako\u0144czy\u0142o si\u0119 niepowodzeniem"),c))).subscribe()}deleteFriend(e){this.apiService.delete(this.friendEndpoint,e).pipe(a(()=>{this._selfFriends.update(i=>i?.filter(r=>r.id!==e))}),s(()=>(this.notificationService.showFailure("Usuni\u0119cie znajomego zako\u0144czy\u0142o si\u0119 niepowodzeniem"),c))).subscribe()}static \u0275fac=function(i){return new(i||n)};static \u0275prov=p({token:n,factory:n.\u0275fac,providedIn:"root"})};var y=class n{userService=t(u);friendService=t(f);collectionService=t(w);viewedUser=o(null);viewedFriends=o(null);viewedCollections=o(null);currentProfileUser=l(()=>this.viewedUser()??this.userService.selfUser());currentProfileFriends=l(()=>this.viewedFriends()??this.friendService.selfFriends().filter(e=>e.status===d.Accepted));currentProfileCollections=l(()=>this.viewedCollections()??this.collectionService.selfCollections());profileChangeSubject=new b;profileChange$=this.profileChangeSubject.asObservable();resetState(){this.viewedUser.set(null),this.viewedFriends.set(null),this.viewedCollections.set(null),this.profileChangeSubject.next(null)}setViewedUser(e,i,r){this.viewedUser.set(e),this.viewedFriends.set(i),this.viewedCollections.set(r),this.profileChangeSubject.next(null)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=p({token:n,factory:n.\u0275fac,providedIn:"root"})};export{d as a,f as b,y as c};
