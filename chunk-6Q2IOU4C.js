import{a as u}from"./chunk-7KZ43VA4.js";import{a as F,r as S,s as g}from"./chunk-6S5I5LFA.js";import{Ab as l,E as o,Kc as c,_ as a,a as v,b as h,ca as p,ia as t,j as m,m as s,s as b}from"./chunk-TIIQBU2L.js";var d={Accepted:"accepted",Sent:"sent",Received:"received",None:""};var f=class n{apiService=t(F);userService=t(u);notificationService=t(S);friendEndpoint="friend";selfFriendsCount=c(()=>{let e=this._selfFriends();return e?e.filter(i=>i.status===d.Accepted).length:0});_selfFriends=l([]);get selfFriends(){return this._selfFriends.asReadonly()}resetState(){this._selfFriends.set([])}fetchSelfFriends(){this.getMyFriends().pipe(a(e=>{this._selfFriends.set(e??[])}),o(()=>(this._selfFriends.set([]),s))).subscribe()}searchFriends(e){return e.length<1?s:this.userService.searchUser(e).pipe(b(i=>i.slice(0,5).map(r=>{let y=this.getFriendStatus(r.id);return{id:r.id,profilePictureUrl:r.profilePictureUrl,username:r.username,status:y}})),o(()=>s))}getFriendStatus(e){return this._selfFriends()?.find(i=>i.id===e)?.status??""}getMyFriends(){return this.apiService.get(this.friendEndpoint)}getOtherUserFriends(e){return this.apiService.get(this.friendEndpoint,e)}getFriendsCount(e){return this.apiService.get(this.friendEndpoint+"/count",e)}sendFriendRequest(e){this.apiService.post(this.friendEndpoint,e).pipe(a(i=>{this._selfFriends.update(r=>r?[...r,i]:[i])}),o(()=>(this.notificationService.showFailure("Wys\u0142anie zaproszenia zako\u0144czy\u0142o si\u0119 niepowodzeniem"),s))).subscribe()}acceptFriendRequest(e){this.apiService.patch(this.friendEndpoint+"/accept-request",e).pipe(a(()=>{this._selfFriends.update(i=>i?.map(r=>e===r.id?h(v({},r),{status:d.Accepted}):r))}),o(()=>(this.notificationService.showFailure("Zaakceptowanie zaproszenia zako\u0144czy\u0142o si\u0119 niepowodzeniem"),s))).subscribe()}deleteFriend(e){this.apiService.delete(this.friendEndpoint,e).pipe(a(()=>{this._selfFriends.update(i=>i?.filter(r=>r.id!==e))}),o(()=>(this.notificationService.showFailure("Usuni\u0119cie znajomego zako\u0144czy\u0142o si\u0119 niepowodzeniem"),s))).subscribe()}static \u0275fac=function(i){return new(i||n)};static \u0275prov=p({token:n,factory:n.\u0275fac,providedIn:"root"})};var w=class n{userService=t(u);friendService=t(f);collectionService=t(g);viewedUser=l(null);viewedFriends=l(null);viewedCollections=l(null);currentProfileUser=c(()=>this.viewedUser()??this.userService.selfUser());currentProfileFriends=c(()=>this.viewedFriends()??this.friendService.selfFriends().filter(e=>e.status===d.Accepted));currentProfileCollections=c(()=>this.viewedCollections()??this.collectionService.selfCollections());profileChangeSubject=new m;profileChange$=this.profileChangeSubject.asObservable();resetState(){this.viewedUser.set(null),this.viewedFriends.set(null),this.viewedCollections.set(null),this.profileChangeSubject.next(null)}setViewedUser(e,i,r){this.viewedUser.set(e),this.viewedFriends.set(i),this.viewedCollections.set(r),this.profileChangeSubject.next(null)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=p({token:n,factory:n.\u0275fac,providedIn:"root"})};export{d as a,f as b,w as c};
