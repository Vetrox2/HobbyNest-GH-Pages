import{b as _,c as y}from"./chunk-LPO5UAHP.js";import{a as g,c as b}from"./chunk-NW3I4PYB.js";import{a as d}from"./chunk-JRISVNOQ.js";import{a as U}from"./chunk-QYTQSEDS.js";import{a as m}from"./chunk-QQTTX4SM.js";import{a as h,s as u}from"./chunk-GB5FS4AS.js";import{Db as p,E as s,I as v,N as f,X as S,ca as t,ia as e,j as n,m as l,o as c}from"./chunk-GTZL7DLP.js";var o=class r{_collectionDetailsStateService=e(b);_collectionService=e(m);_friendService=e(_);_userProfileService=e(y);_userService=e(d);_homeService=e(U);resetState(){this._collectionDetailsStateService.resetState(),this._collectionService.resetState(),this._friendService.resetState(),this._userProfileService.resetState(),this._userService.resetState(),this._homeService.resetState()}fetchSelfCollectionState(){return this._collectionService.fetchSelfCollections()}fetchSelfFriendState(){return this._friendService.fetchSelfFriends()}fetchSelfUserState(){return this._userService.fetchSelf()}static \u0275fac=function(a){return new(a||r)};static \u0275prov=t({token:r,factory:r.\u0275fac,providedIn:"root"})};var j=class r{refreshUrl="auth/refresh";loginUrl="auth/google";logoutUrl="auth/logout";checkUrl="auth/check";_apiService=e(h);_navigationService=e(g);_stateFacadeService=e(o);_notificationService=e(u);_isRefreshing=p(!1);refreshSubject=new n;get isRefreshing(){return this._isRefreshing()}loginWithGoogle(i){return this._apiService.post(this.loginUrl,{idToken:i})}logout(){this._apiService.post(this.logoutUrl).subscribe(()=>{this._stateFacadeService.resetState(),this._navigationService.navigateToLogin()})}isLoggedIn(){return this._apiService.get(this.checkUrl).pipe(s(()=>c(!1)))}refreshToken(){return this._isRefreshing()?this.refreshSubject.pipe(v(1),S(()=>c(null))):(this._isRefreshing.set(!0),this._apiService.post(this.refreshUrl).pipe(s(i=>(this._navigationService.navigateToLogin(),this._notificationService.showFailure(i.message),l)),f(()=>{this._isRefreshing.set(!1),this.refreshSubject.next()})))}static \u0275fac=function(a){return new(a||r)};static \u0275prov=t({token:r,factory:r.\u0275fac,providedIn:"root"})};export{j as a};
